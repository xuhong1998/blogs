---
title: SSL
date: 2020-06-11 15:51:40
tags: 
- 网络协议
---
## HTTP 缺点
 在标准的HTTP协议下，客户端与服务端直接通过TCP链接，以明文的形式传递数据。这样做就有可能存在信息窃听或者身份伪装问题。一个安全的传输必须包含三个特点：
 + 数据加密性，防止内容被窃听。
 + 数据的完整性，防止传输内容被篡改。
 + 鉴别身份，防止遭遇伪装
 这些问题不仅在HTTP协议中存在，在其他未加密的协议也存在相同的问题。

## SSL协议
 > SSL就是提供数据机密性，数据完整性以及身份鉴别的安全协议，全称安全套接层（SECURE SOCKETS I AYER）。
 > 因为SSL运行在TCP之上的，所以不光是HTTP协议，其他运行在应用层的SMTP和Telne等协议均可配合SSL协议使用。

## 加密机制
 > SSL采用公开密钥和共享密钥两者并用的加密机制加密。
 
 #### 共享密钥
 > 加密和解密同用一个密钥的方式称为共享密钥加密（Common key crypto system），也被叫做对称密钥加密。这样加密效率很高，但是发送密钥就有被窃听的风险，但不发送，对方就不能解密。

 #### 公开密钥
 > 公开密钥加密使用一对非对称的密钥。一把叫私有密钥（private key），另一把叫做公开密钥（public key）。顾名思义，私有密钥不能让任何人知道，而公开密钥则可以随意发布，任何人都可以获得。这样就不必担心密钥被攻击者盗取，但是效率没有对称加密高。
 
## 信息传输完整性
 > MAC是消息认证码（带密钥的Hash函数）。是一种用来鉴别信息传递完整性的技术。其中工作机制就是发送方使用一个鉴别密钥与明文进行级联，随后计算这个级联后的数据的散列值，将它和数据一同发送，接收方收到报文后，以同样的方法进行级联，并计算散列值，将两个散列值进行对比，若两者相等，则报文通过认证。

## 证书 
 > 服务端证书是用来证明通信一方服务器是否规范，另外可以确认对方服务器是否真实存在。上述机制是为了防止用户钓鱼攻击。
 客户端证书进行客户端认证，证明服务器正在通信的是预料之内的客户端，由于客户端证书获取成本比较高，所以客户端证书仅用户特殊用途的业务。比如银行系统。

## SSL握手过程

 - 客户端发送Client Hello 报文开始SSL通信，报文中包含客户端支持的SSL版本、加密组件、的随机数 Random1等。
 - 服务端发送Server Hello 报文作为应答，报文中包含随机数Random2以及从客户端选择的版本和加密组件。
 - 服务端发送certificates 报文，报文中包含证书密钥。客户端验证证书有效性，并提取公钥。
 - 服务端发送Server Hello Done 报文，说明第一次SSL握手协商结束。
 - 客户端发送Client Key Exchange 报文，客户端随机密码串Random3，使用公开密钥进行加密（PreMaster Key）并且传输。然后两边根据同样的算法将Random1+Random2+Random3生成密钥。
 - 客户端发送Change Cipher Space 报文，报文提示服务器之后通信使用pre-master secret 密钥加密。
 - 客户端发送Finished 报文，报文包含链接至今的全部报文的整体校验值。
 - 服务端发送 Change Cipher Space 报文。
 - 服务端发送Finished 报文。SSL链接建立完成。
 - 发送HTTP响应。
 - 客户端发送close_notify报文。断开链接。
 